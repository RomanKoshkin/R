---
title: "Has the Proportion of Middle Class Americans Changed?"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction And Research Question

Middle class is widely regarded as the backbone of any nation's prosperity. No wonder that the status and outlook of middle class Americans has traditionally been a key priority of many presidential candidates in the United States. But I often hear that middle class has been shrinking in America, and that the government overall has failed in pursuing the vision of a strong middle class. As a middle class person myself, I would like to check whether it is true based on data, not rumors.

## Data

To answer this question, we will use the GSS dataset containing the results of the surveys conducted between 1972 and 2012 (Smith, Houth & Marsden, 2013). It contains data on 114 indicators. We will focus on the two that are relevant to the question at hand, namely the `class` variable (subjective class identification) with levels: `Lower Class`, `Working Class`, `Middle Class` and `Upper Class`, and the numerical variable `year` (the year in which the a particular response was recorded) that we will be treating here as a factor with two levels: `1972` and `2012`. For the purposes of simplicity, we will assume that that the change in the proportion of middle class Americans, if any, has changed monotonically over the widest period for which the data are available in our dataset (i.e. from 1972 to 2012).  

For convenience, we subset the data relevant to our research question and collapse the three non-middle-class levels of the `class` variable such that as a result we are left with only two levels (middle class `Mid` ("success") or not middle class `NonMid` ("failure"))

```{r table, echo=TRUE}
# suppress unnecessary messages and warnings:
suppressWarnings(suppressMessages(library(gdata)))
suppressWarnings(suppressMessages(library(statsr)))

# import dependencies:
library(gdata)
load("/Users/RomanKoshkin/Documents/R/GSS.RData", .GlobalEnv)

# Get rid of the the cases with missing data in the factor of interest ("Class")
# create a new dataframe:
gss1 <- gss[gss$class %in% c("Middle Class", "Working Class", "Upper Class", "Lower Class") &
              gss$year %in% c("1972", "2012"), ]

# drop unused levels from the "class"" factor ("NA" and "No Class"):
levels(gss1$class) <- drop.levels(gss1$class)

#change levels of the class factor directly in the dataframe gss1:
levels(gss1$class)[levels(gss1$class) != "Middle Class"] <- "NonMid"
levels(gss1$class)[levels(gss1$class) == "Middle Class"] <- "Mid"
```
### Summary statistics
```{r table1, echo=TRUE}
# Raw counts:
tbl <- table(gss1$class,gss1$year)
addmargins(tbl)

# Proportions:
tbl <- prop.table(tbl, 2)
tbl
```

## Hypothesis

The hypotheses appropriate to the researth question are as follows:

H0: The proportion of middle class Americans in 2012 was the same as it was in 1972 $(p_1 = p_2)$.  
HA: The proportion of middle class Americans in 2012 was different than in 1972 $(p_1 ≠ p_2)$.  

## Check conditions
Before hypothesis testing we need to check if the conditions of the normal model are met.

### Independence
The first condition, independence, appears to have been met, because the GSS, as a serious organization, is expected to make sure the sampling was random and the respondets were independent of each other. The number of respondents that have classified themselves as middleclass or otherwise is clearly greater than 10% of the entire U.S. population. 

### Success-Failure
The second, the success-failure condition, also appears to have been met (we chose to count Mid as "success"):

$n_1 p_1 ≥ 10$ and $n_1 (1-p_1) ≥ 10$       =>   $1604*900/1604  > 10$ and $1604(1 - 900/1604) > 10$   
$n_2 p_2 ≥ 10$ and $n_2 (1-p_2) ≥ 10$       =>   $1957*1118/1957 > 10$ and $1957(1 - 1118/1957) > 10$ 
 
Since the conditions necessary for the statistical tests of two proportions have been met, their results can be generalize to the entire population.

## Testing the Hypothesis
Now that we have checked our conditions, we can proceed with testing the hypotesis using the normal model. We will use the convenient `inference` method of the `statsr` package:
```{r table3, echo=TRUE}
# import dependencies:
library(statsr)

# perform hypothesis testing:
Year <- as.factor(gss1$year)
inference(y = class, x = Year, data = gss1, statistic = "proportion", 
          success = "Mid", null = 0, type = "ht", method = "theoretical", alternative = "twosided")
```

## Calculating the 95% Confidence Interval
```{r tab3, echo=TRUE}

# initialize proportions:
p1 = 0.5611
p2 = 0.5713

# compute the standard error:
SE = sqrt(p1*(1-p1)/1604 + p2*(1-p2)/1957)

# compute the confidence interval:
CI_upper = (p1-p2) + 1.96*SE
CI_lower = (p1-p2) - 1.96*SE
```

```{r tab4}
# Print the CI:
CI_upper
CI_lower
```

The 95% confedence inverval (-0.04291978 0.02251978) contains zero, which provides another proof that we cannot reject the null hypothesis.

## Conclusions
There was a small difference in the proportion of middle class Americans in 2012 compared to 1972. However, this difference did not reach significance at 5% level (p-value = 0.5417). Therefore, we do not reject the null hypothesis and conclude that the data DO NOT provide convincing evidence that the proportion of middle class Americans in 2012 was significantly different from the proportion of middle class Americans in 1972.

##References

Smith, Tom W., Michael Hout, and Peter V. Marsden. General Social Survey, 1972-2012 [Cumulative File]. ICPSR34802-v1. Storrs, CT: Roper Center for Public Opinion Research, University of Connecticut /Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributors], 2013-09-11. doi:10.3886/ICPSR34802.v1

Persistent URL: http://doi.org/10.3886/ICPSR34802.v1e